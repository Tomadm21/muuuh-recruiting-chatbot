{% extends "admin/base.html" %}

{% block content %}
<div class="page-header">
    <a href="/admin/dashboard" class="btn btn-outline"
        style="border:none; padding-left:0; color:var(--text-secondary);">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round" style="margin-right:6px;">
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
        Back to Dashboard
    </a>
    <div style="display:flex; gap:12px;">
        <button class="btn btn-outline" onclick="window.print()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;">
                <polyline points="6 9 6 2 18 2 18 9"></polyline>
                <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                <rect x="6" y="14" width="12" height="8"></rect>
            </svg>
            Print Report
        </button>
    </div>
</div>

<div style="display:grid; grid-template-columns: 2fr 1fr; gap:30px; margin-bottom:60px;">

    <!-- MAIN REPORT (Paper Style) -->
    <div style="background:white; border-radius:4px; box-shadow:var(--shadow-md); padding:50px; min-height:800px;">

        <!-- Report Header -->
        <div
            style="border-bottom:2px solid var(--text-primary); padding-bottom:20px; margin-bottom:40px; display:flex; justify-content:space-between; align-items:flex-end;">
            <div>
                <div
                    style="font-size:0.75rem; text-transform:uppercase; letter-spacing:2px; color:var(--text-secondary); margin-bottom:8px;">
                    Confidential Candidate Report</div>
                <h1 style="margin:0; font-size:2rem; letter-spacing:-1px;">{{ lead.name or "Candidate #" ~ lead.id }}
                </h1>
            </div>
            <div style="text-align:right;">
                <div
                    style="font-weight:600; font-size:1.5rem; color: {% if lead.qualification_score >= 80 %}#10b981{% elif lead.qualification_score >= 50 %}#f59e0b{% else %}#ef4444{% endif %}">
                    {{ lead.qualification_score }} <span
                        style="font-size:1rem; color:var(--text-tertiary); font-weight:400;">/ 100</span>
                </div>
                <div style="font-size:0.75rem; color:var(--text-tertiary); margin-top:4px;">MATCH SCORE</div>
            </div>
        </div>

        <!-- Summary -->
        <div style="margin-bottom:40px;">
            <h3
                style="font-size:0.85rem; font-weight:700; text-transform:uppercase; letter-spacing:1px; margin-bottom:15px; color:var(--text-primary);">
                Executive Summary</h3>
            {% if lead.projects and lead.projects.summary %}
            <p style="font-size:1rem; line-height:1.7; color:#374151;">
                {{ lead.projects.summary }}
            </p>
            {% else %}
            <p style="color:var(--text-tertiary); font-style:italic;">Analysis pending...</p>
            {% endif %}
        </div>

        <!-- Pros/Cons Grid -->
        {% if lead.projects %}
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:40px; margin-bottom:40px;">
            <div>
                <h4
                    style="font-size:0.8rem; font-weight:700; color:#10b981; text-transform:uppercase; letter-spacing:1px; margin-bottom:15px; border-bottom:1px solid #10b981; padding-bottom:8px;">
                    Strengths</h4>
                <ul style="list-style:none; padding:0; margin:0;">
                    {% for pro in lead.projects.pros %}
                    <li
                        style="margin-bottom:12px; display:flex; align-items:start; gap:10px; font-size:0.95rem; color:#374151;">
                        <span style="color:#10b981; font-weight:bold;">+</span> {{ pro }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            <div>
                <h4
                    style="font-size:0.8rem; font-weight:700; color:#ef4444; text-transform:uppercase; letter-spacing:1px; margin-bottom:15px; border-bottom:1px solid #ef4444; padding-bottom:8px;">
                    Risks</h4>
                <ul style="list-style:none; padding:0; margin:0;">
                    {% for con in lead.projects.cons %}
                    <li
                        style="margin-bottom:12px; display:flex; align-items:start; gap:10px; font-size:0.95rem; color:#374151;">
                        <span style="color:#ef4444; font-weight:bold;">âˆ’</span> {{ con }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}

        <!-- Meta Data -->
        <div
            style="background:#f9fafb; padding:24px; border-radius:4px; display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
            <div>
                <div style="font-size:0.75rem; color:var(--text-tertiary); text-transform:uppercase;">Position Interest
                </div>
                <div style="font-weight:500;">{{ lead.position_interest }}</div>
            </div>
            <div>
                <div style="font-size:0.75rem; color:var(--text-tertiary); text-transform:uppercase;">Experience</div>
                <div style="font-weight:500;">{{ lead.years_of_experience or "N/A" }} Years</div>
            </div>
            <div>
                <div style="font-size:0.75rem; color:var(--text-tertiary); text-transform:uppercase;">Contact</div>
                <div style="font-weight:500;">{{ lead.phone or lead.whatsapp_number }}</div>
            </div>
            <div>
                <div style="font-size:0.75rem; color:var(--text-tertiary); text-transform:uppercase;">Source</div>
                <div style="font-weight:500;">{{ lead.source or "Direct" }}</div>
            </div>
        </div>

    </div>

    <!-- SIDEBAR (Documents & Transcript) -->
    <div style="display:flex; flex-direction:column; gap:20px;">

        <!-- Documents Card -->
        <div style="background:var(--bg-card); padding:24px; border-radius:8px; border:1px solid var(--border-subtle);">
            <h3 style="font-size:0.9rem; font-weight:600; margin-bottom:15px;">Documents</h3>
            {% if lead.cv_file_path %}
            <a href="{{ lead.cv_file_path if not lead.cv_file_path.startswith('url:') else lead.cv_file_path[4:] }}"
                target="_blank" class="btn btn-outline" style="width:100%; justify-content:center; margin-bottom:10px;">
                Download CV
            </a>
            {% else %}
            <div style="color:var(--text-tertiary); font-style:italic; font-size:0.9rem;">No CV available</div>
            {% endif %}
        </div>

        <!-- Transcript Card -->
        <div
            style="background:var(--bg-card); padding:24px; border-radius:8px; border:1px solid var(--border-subtle); flex:1; display:flex; flex-direction:column;">
            <h3 style="font-size:0.9rem; font-weight:600; margin-bottom:15px;">Interview Transcript</h3>
            <div style="flex:1; overflow-y:auto; max-height:500px; padding-right:5px;">
                {% for msg in lead.conversation_history %}
                <div style="margin-bottom:12px;">
                    <div style="font-size:0.7rem; color:var(--text-tertiary); margin-bottom:2px;">{{ 'Candidate' if
                        msg.role == 'user' else 'System' }}</div>
                    <div
                        style="background:{{ '#f3f4f6' if msg.role == 'user' else 'white' }}; padding:8px 12px; border-radius:6px; border:1px solid {{ 'transparent' if msg.role == 'user' else 'var(--border-subtle)' }}; font-size:0.85rem; color:var(--text-primary);">
                        {{ msg.content }}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

    </div>

</div>
{% endblock %}